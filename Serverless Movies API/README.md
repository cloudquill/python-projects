# Serverless Movies API

## Overview

This serverless function provides a simple API for accessing movie information stored in a database. It includes several endpoints to retrieve a list of movies, filter movies by release year, and generate summaries for specific movies using AI.

## Features

- **GetMovies**: Returns a JSON list of all movies in the database.
- **GetMoviesByYear**: Returns a list of movies released in a specified year, as provided by the user.
- **GetMovieSummary**: Returns a generated summary for a specified movie using AI.

## API Endpoints

### 1. GetMovies

**Endpoint**: `/getmovies`

**Description**: Returns a JSON array of all movies in the database.

### 2. GetMoviesByYear

**Endpoint**: `/getmoviesbyyear/<year>`  
**Query Parameter**: `year` (required)

**Description**: Returns a list of movies that were released in the specified year.

**Example Request**:
```
/getmoviesbyyear/2009
```

### 3. GetMovieSummary

**Endpoint**: `/getmoviesummary/<movie_name>`  
**Query Parameter**: `movie_name` (required)

**Description**: Returns a summary generated by AI for the specified movie title.

**Example Request**:
```
/getmoviesummary/Avatar
```

## Setup Instructions

1. **Clone the Repository**

2. **Install Dependencies**:
   Make sure you have the necessary dependencies installed. Run this with Python installed:
   ```python
   pip install -r requirements.txt
   ```

3. **Obtain a trial API key from Cohere AI**:
    Sign up to [Cohere AI](https://cohere.com/) to get a free API key you can use to generate movie summaries:
    - From the sidebar, click on "API Keys"
    - Click on "New Trial Key"
    - Fill in a name for the key and click on generate
    - Copy the key  

3. **Configure Environment Variables**:
   Set up environment variables for the storage account connection and AI service access in a `.env` file:
   - `ACCOUNT_URI`
   - `ACCOUNT_KEY`
   - `COHERE_API_KEY`  

   **Note**: This applies only to local testing. When deploying to Azure, comment out `dotenv import` and `load_dotenv()` in the `config.py` file. The environment variables can then be set in the app settings in the function app.

4. **Deploy the Function to Azure**:
   It is much easier to deploy to Azure with VS Code:
   ![Steps to deploying function to Azure](/Serverless%20Movies%20API/images/serverless%20movies%20pic.jpg?raw=true "Deploy Function to Azure Steps")
   - Install the Azure Function extension.
   - Click the Azure Function icon in the sidebar.
   - Click the little Azure Function icon that appears when you hover over the "WORKSPACE" header tab.
   - From the dropdown, click Deploy To Azure and follow the prompts.

## Usage
![Open the Output window](/Serverless%20Movies%20API/images/open_output_window.jpg?raw=true "Output window")

After deployment, start interacting with the API by opening the Output tab using Ctrl+Shift+U or Ctrl+` and navigating to the Output tab.

The presence of Tigger URLs indicates that your function has been deployed successfully and is ready to use. 

## Issues
If you see a "No HTTP triggers found" message after deploying to Azure, try the following steps:
- Run the function locally to verify it works.
- Comment out the dotenv import and load_dotenv() in the config file and consider removing it from the requirements file before redeploying.
- Switch to the Flex Consumption Plan or higher.
- Ensure that the function names in `function_app.py` match those in the `host.json` file.

## Contributing

Contributions are welcome! Please open an issue or submit a pull request if you'd like to contribute.

## License

This project is licensed under the MIT License. See the LICENSE file for details.

## Acknowledgments

- [Movie Dataset from rand.fun](https://github.com/randfun/movies-dataset)
- [Cohere AI](https://cohere.com/) for AI services.
